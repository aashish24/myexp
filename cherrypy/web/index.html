<html>
  <head>
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script type="text/javascript">
    function getItemDisplayString(item) {
      var displayStr = "[";
      for (var i in item) {
        if (item.hasOwnProperty(i)) {
          displayStr += i + " : " + item[i] + " | "
        }
      }
      displayStr += "]";
      return displayStr;
    }
    
    function getCollectionItems(node, database, collectionName) {      
      $.ajax({
        type: "POST",
        url: "/collections/" + database + "/" + collectionName   
      }).done(function( msg ) {
        console.log(msg);
        var data = jQuery.parseJSON( msg );                
        var tableRoot = document.createElement("table");
        tableRoot.setAttribute("class", "table");
        console.log(data);
        $.each(data["data"], function(i, item) {
          var row = document.createElement("tr");
          tableRoot.appendChild(row);
          var col = document.createElement("td");
          col.appendChild(document.createTextNode(getItemDisplayString(item)));
          row.appendChild(col);        
        });
        node.appendChild(tableRoot);
    }).fail(function ( msg ) {
    });
   };
   
   function addLayer(elem) {     
     var _id = $(elem).attr("_id");     
     if (_id !== null) {
       var layersRoot = $("#layersRoot");
       var basename = $(elem).attr("name");
       $(elem).removeClass("btn-primary");
       $(elem).addClass("btn-success");
       $(elem).attr("disabled", "disabled").addClass("disabled");
       layersRoot.append("<div><a>" + basename + "</a></div>");
     }
   }
    
    $(document).ready(function() {
      $.ajax({
        type: "POST",
        url: "/documents"
      }).done(function( msg ) {
        var data = jQuery.parseJSON( msg );
        console.log(data);
        var listRoot = document.getElementById("collections");                   
        $.each(data, function(i, collection) {
          
          if (collection === "system.indexes" || 
              collection === "fs.files" ||
              collection === "fs.chunks") {
            return; 
          }
          
          var itemRoot = document.createElement("div");
          itemRoot.setAttribute("class", "accordion-group");
          listRoot.appendChild(itemRoot);
          var itemHeading = document.createElement("div");
          itemHeading.setAttribute("class", "accordion-heading");
          itemRoot.appendChild(itemHeading);
          var itemCollection = document.createElement("a");
          itemCollection.setAttribute("class", "accordion-toggle");
          itemCollection.setAttribute("data-toggle", "collapse");
          itemCollection.setAttribute("data-parent", "#collections");
          itemCollection.setAttribute("href", "#"+i);
          itemCollection.appendChild(document.createTextNode(i));
          itemHeading.appendChild(itemCollection);
          
          var subItemsRoot = document.createElement("div");
          subItemsRoot.setAttribute("class", "accordion-body collapse in");
          subItemsRoot.setAttribute("id", i)
          itemRoot.appendChild(subItemsRoot);
          var subItemsList = document.createElement("div");
          subItemsList.setAttribute("class", "accordion-inner");
          subItemsRoot.appendChild(subItemsList);
          var tableRoot = document.createElement("table");
          //tableRoot.setAttribute("class", "table table-hover");
          subItemsList.appendChild(tableRoot);
          
          $.each(collection, function(j, item) {            
            var row = document.createElement("tr");
            row.setAttribute("class", "success");
            tableRoot.appendChild(row);
            var col = document.createElement("td");
            col.appendChild(document.createTextNode(item.basename));
            row.appendChild(col);
            col = document.createElement("td");            
            var button = document.createElement("button");
            button.setAttribute("type", "button");
            button.setAttribute("class", "btn btn-primary");
            button.setAttribute("_id", item._id);
            button.setAttribute("name", item.name);
            button.setAttribute("onclick", "addLayer(this);")
            button.setAttribute("data-toggle", "button");
            button.appendChild(document.createTextNode("Add Layer"));
            col.appendChild(button);
            row.appendChild(col);            
          }); 
        });        
        $("#data").append(listRoot);
      }).fail(function( msg ) {
        alert(msg);
      });
    });
    </script>
  </head>
  <body>    
    <div id="layers-container" class="row">
      <div class="accordion span5" id="layers">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
              Active Layers
            </a>
          </div>
          <div id="collapseOne" class="accordion-body collapse">
            <div class="accordion-inner" id="layersRoot">               
            </div>
          </div>     
        </div>
      </div>
    </div>
    <div id="documents-container" class="row">
      <div class="accordion span5" id="layers">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#doc-container">
              Documents
            </a>
          </div>
          <div id="doc-container" class="accordion-body collapse in">
            <div class="accordion-inner">
              <div id="collections" class="accordion">
              </div>               
            </div>
          </div>     
        </div>
      </div>
    </div>
  </body>
</html>