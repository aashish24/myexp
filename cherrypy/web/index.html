<html>
  <head>
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script type="text/javascript">
    var archive = {};

    archive.getMongoConfig() {
      "use strict";
        return {
          server:localStorage.getItem('archive:mongodb-server') || 'localhost',
          database:localStorage.getItem('archive:mongodb-database') || 'documents',
          collection:localStorage.getItem('archive:mongodb-collection') || 'files'
        }
    }

    function getDocuments() {
      mongo = archive.getMongoConfig();
      $.ajax({
        type: 'POST',
        url: "/mongo/' + mongo.server + '/' + mongo.database + '/' + mongo.collection,
        data: {
          query:
          limit:100,
          fields: JSON.stringify(['name', 'basename'])
        },
        dataType: 'json',
        success: function(response) {
          if (response.error !== null) {
              console.log("[error] " + response.error ? response.error : "no results returned from server");
          } else {
            var noOfResults = response.result.data.length;
            console.log(response.result.data);
          }
        }
    }


    function getItemDisplayString(item) {
      var displayStr = "[";
      for (var i in item) {
        if (item.hasOwnProperty(i)) {
          displayStr += i + " : " + item[i] + " | "
        }
      }
      displayStr += "]";
      return displayStr;
    }

    function getCollectionItems(node, database, collectionName) {
      $.ajax({
        type: "POST",
        url: "/collections/" + database + "/" + collectionName
      }).done(function( msg ) {
        console.log(msg);
        var data = jQuery.parseJSON( msg );
        var tableRoot = document.createElement("table");
        tableRoot.setAttribute("class", "table");
        console.log(data);
        $.each(data["data"], function(i, item) {
          var row = document.createElement("tr");
          tableRoot.appendChild(row);
          var col = document.createElement("td");
          col.appendChild(document.createTextNode(getItemDisplayString(item)));
          row.appendChild(col);
        });
        node.appendChild(tableRoot);
    }).fail(function ( msg ) {
    });
   };

   function addLayer(elem) {
     var _id = $(elem).attr("_id");
     if (_id !== null) {
       var tbody = $("#layersRootTable").find('tbody');
       var basename = $(elem).attr("name");
       $(elem).removeClass("btn-primary");
       $(elem).addClass("btn-success");
       $(elem).addClass("disabled");
       $(tbody).append("<tr id=layer_"+_id+">");
       $("#layersRootTable tr:last").append("<td>" + basename + "</td>")
       $("#layersRootTable tr:last").append("<td><button class='btn btn-warning'> Hide </button></td>");
     }
   }

   function removeLayer(elem) {
     var _id = $(elem).attr("_id");
     var layerId = "#layer_" + _id;
     $(layerId).remove();
     return false;
   }

   $(function() {
    getDocuments();
   }

    </script>
  </head>
  <body>
    <div id="layers-container" class="row">
      <div class="accordion span6" id="layers">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
              Active Layers
            </a>
          </div>
          <div id="collapseOne" class="accordion-body collapse">
            <div class="accordion-inner" id="layersRoot">
              <table id="layersRootTable">
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="documents-container" class="row">
      <div class="accordion span6" id="layers">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#doc-container">
              Documents
            </a>
          </div>
          <div id="doc-container" class="accordion-body collapse in">
            <div class="accordion-inner">
              <div id="collections" class="accordion">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
