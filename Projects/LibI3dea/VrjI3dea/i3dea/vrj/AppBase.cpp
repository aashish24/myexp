

#include "i3dea/Vrj/AppBase.h"

#include "vrj/Kernel/Kernel.h"


i3dea::vrj::AppBase* i3dea::vrj::AppBase::_appBaseInstance = 0x00; 	


namespace i3dea
{
	namespace vrj
	{
		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		AppBase::AppBase()
		{
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		AppBase::~AppBase()
		{			
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		AppBase&  AppBase::instance()
		{			
			if( _appBaseInstance )
			{
				return ( *_appBaseInstance );
			}
			else
			{
				_appBaseInstance = new AppBase();
				return ( *_appBaseInstance );
			}
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::displayFunc( IFunctor* displayFunctor )
		{
			_displayFunctor = displayFunctor;
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::run()
		{
			if( _appBaseInstance ) 
			{			
				::vrj::Kernel* kernel = ::vrj::Kernel::instance();
				
				if(! kernel )
				{
				}
				
				kernel->start();
				kernel->setApplication( _appBaseInstance );
				
				// Some how we have to do this: 
				// Find out where this dll is
				// Relative to that we will find the config. 
				kernel->loadConfigFile( "C:\\aashish\\src\\osve\\current\\osve\\trunk\\Indra\\configs\\vrjuggler\\2.2.x\\original\\simstandalone.jconf" );
				
				kernel->waitForKernelStop();
		
			}
			else
			{
				// Throw an exception here. 
			}
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////
		
		void AppBase::exit()
		{
			if( _appBaseInstance )
			{
				delete AppBase::_appBaseInstance;
			}
		}

		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::contextInit()
		{
			::vrj::GlApp::contextInit();
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::init()
		{
			::vrj::GlApp::init();
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::preFrame()
		{
			::vrj::GlApp::preFrame();
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::intraFrame()
		{
			::vrj::GlApp::intraFrame();
		}


		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::postFrame()
		{
			::vrj::GlApp::postFrame();
		}		
		

    void AppBase::bufferPreDraw()
    {
      glClearColor( 0.0, 0.0, 0.0, 1.0 );
      glClear( GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT );
    }

		///////////////////////////////////////////////////////////////////////
		//
		//
		//
		///////////////////////////////////////////////////////////////////////

		void AppBase::draw()
		{
			_displayFunctor->call();
		}		
	}
}